<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/cli.js | usn</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<link rel="stylesheet" href="./inject/css/0-readme.css"><meta name="description" content="Command line tool and library for working with USN data"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="usn"><meta property="twitter:description" content="Command line tool and library for working with USN data"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  </ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/cli.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">require(&apos;dotenv&apos;).config();
const {cross} = require(&apos;figures&apos;);
const {bold, cyan} = require(&apos;chalk&apos;);
const {format} = require(&apos;tomo-cli&apos;);
const {dict, getCurrentYear} = require(&apos;./utils/common.js&apos;);
const {populate, update} = require(&apos;./utils/data.js&apos;);

const getAction = (command, flags, defaultAction) =&gt; {
    const {id, key, type, verbose, year} = flags;
    const years = [...new Set(year.split(&apos;,&apos;))].sort();
    const noCommand = stdin =&gt; {
        if (typeof command === &apos;string&apos;) {
            const message = `\n${bold.red(cross)} &quot;${command}&quot; is not a known command...Please read the help below.\n`;
            process.stderr.write(message);
            defaultAction();
        } else {
            process.stdout.write(`STDIN: ${stdin}`);
        }
    };
    const lookup = dict({
        populate: async () =&gt; {
            await populate(type, years, {id, key});
        },
        update: async () =&gt; {
            const results = await update(type, {id, key, verbose});
            results.objectIDs.length &gt; 0 &amp;&amp; process.stdout.write(format(results));
        },
        info: async () =&gt; {/* eslint-disable no-console */
            console.log(`\n  ${bold(&apos;ID&apos;)}  = `, id);
            console.log(`  ${bold(&apos;Key&apos;)} = `, key);
        }/* eslint-enable no-console */
    });
    return lookup.has(command) ? lookup.get(command) : noCommand;
};
const help = `
    ${bold.bgBlue.white(&apos; Navy Search &apos;)}
      
        ${cyan(`&quot;Search for those that ${bold(&apos;serve&apos;)}&quot;`)}

    ${bold.dim(&apos;Usage&apos;)}

        ./usn.exe [commands] [options]


    ${bold.dim(&apos;Commands&apos;)}

        populate, update, version

`;
const options = {
    help,
    flags: {
        help: {
            type: &apos;boolean&apos;,
            default: false,
            alias: &apos;h&apos;
        },
        version: {
            type: &apos;boolean&apos;,
            default: false,
            alias: &apos;v&apos;
        },
        verbose: {
            type: &apos;boolean&apos;,
            default: false,
            alias: &apos;V&apos;
        },
        type: {
            type: &apos;string&apos;,
            default: &apos;NAVADMIN&apos;,
            alias: &apos;t&apos;
        },
        year: {
            type: &apos;string&apos;,
            default: String(getCurrentYear()),
            alias: &apos;y&apos;
        },
        id: {
            type: &apos;string&apos;,
            default: process.env.ALGOLIA_APP_ID || bold.red(&apos;not set&apos;)
        },
        key: {
            type: &apos;string&apos;,
            default: process.env.ALGOLIA_ADMIN_API_KEY || bold.red(&apos;not set&apos;)
        }
    }
};

module.exports = {
    getAction,
    options
};</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
